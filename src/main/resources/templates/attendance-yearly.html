<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <!-- head共通部分 -->
    <th:block th:replace="~{fragments/head :: head}"></th:block>
    <link href="../static/css/attendance-yearly.css" th:href="@{/css/attendance-yearly.css}" rel="stylesheet" />
    <title>勤怠履歴 - ShiftSync</title>
</head>

<body>
    <!-- header共通部分 -->
    <th:block th:replace="~{fragments/header :: header}"></th:block>

    <div class="container">
        <h2>勤怠履歴</h2>

        <!-- 月の選択ドロップダウン -->
        <form th:action="@{/attendance-yearly}" method="get">
            <label for="month">月を選択:</label>
            <select name="month" id="month">
                <option th:each="i : ${#numbers.sequence(1,12)}"
                        th:value="${i}" th:text="${i}">1</option>
            </select>
            <button type="submit">表示</button>
        </form>

        <!-- 選択した月を表示 -->
        <p th:text="'選択された月: ' + ${selectedMonth} + '月の勤怠履歴'"></p>
        
 		<!-- CSVダウンロードリンク (Thymeleafを利用してサーバーサイドで解決する場合) -->
		<a th:href="@{/download-csv(month=${selectedMonth})}" class="btn btn-primary">Download CSV</a>


        <!-- 勤怠テーブル -->
        <table class="attendance-table">
            <thead>
            <tr>
				<th>年月日</th>
                <th>出勤時刻</th>
                <th>退勤時刻</th>
                <th>勤務時間</th>
                <th>出勤データ修正</th>
                <th>退勤データ修正</th>
            </tr>
            </thead>
            <tbody>
            <tr th:if="${#lists.isEmpty(attendance_records)}">
                <td colspan="6" th:text="${message}">データがありません</td>
            </tr>
            <tr th:each="attendance_record : ${attendance_records}">
				<td th:text="${#dates.format(attendance_record.clockIn, 'yyyy-MM-dd')}"></td>
                <td th:text="${#dates.format(attendance_record.clockIn, 'HH:mm:ss')}"></td>
                <td th:text="${#dates.format(attendance_record.clockOut, 'HH:mm:ss')}"></td>
                <td th:text="${attendance_record.workDuration}"></td>
                <td>
                    <!-- 出勤時間修正フォーム -->
                    <form th:action="@{/updateClockInTime}" method="post" style="display:inline;">
						<input type="hidden" name="month" th:value="${selectedMonth}" />
                        <input type="hidden" name="recordId" th:value="${attendance_record.recordId}" />
                        <input type="hidden" name="employeeId" th:value="${attendance_record.employeeId}" />
                        <input type="hidden" name="currentClockIn" th:value="${#dates.format(attendance_record.clockIn, 'yyyy-MM-dd HH:mm:ss')}" />
                        <input type="time" name="newClockIn" placeholder="時間" required />
                        <button type="submit">出勤時刻の修正</button>
                    </form>
                </td>
                <td>
                    <!-- 退勤時間修正フォーム -->
                    <form th:action="@{/updateClockOutTime}" method="post" style="display:inline;">
						<input type="hidden" name="month" th:value="${selectedMonth}" />
                        <input type="hidden" name="recordId" th:value="${attendance_record.recordId}" />
                        <input type="hidden" name="employeeId" th:value="${attendance_record.employeeId}" />
                        <input type="hidden" name="currentClockOut" th:value="${#dates.format(attendance_record.clockOut, 'yyyy-MM-dd HH:mm:ss')}" />
                        <input type="time" name="newClockOut" placeholder="時間" required />
                        <button type="submit">退勤時刻の修正</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>

        <a th:href="@{/}">戻る</a>
    </div>

    <!-- footer共通部分 -->
    <th:block th:replace="~{fragments/footer :: footer}"></th:block>
</body>
</html>
